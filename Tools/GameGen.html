<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Team Gen & Double Elims Predictor</title>
    <link rel="icon" type="image/x-icon" href="images/favIcon.png" />
    <style>body {font-family: Arial, sans-serif;margin: 0;padding: 0;}.Navbar {background-color: #333;color: #fff;padding: 10px;}.Backbox {margin: 20px auto;padding: 20px;max-width: 800px;border: 1px solid #ff8800;border-radius: 5px;background-color: #b8b5b5;}.Team-Inputs {display: grid;grid-template-columns: repeat(4, 1fr);gap: 10px;margin-bottom: 20px;}.Team {border: 1px solid #ddd;padding: 10px;border-radius: 5px;background-color: #fff;}.Team h3 {margin-top: 0;}.Team label {display: block;margin-bottom: 5px;}.Team input {width: 95%;padding: 5px;margin-bottom: 10px;}.Results {text-align: center;margin-top: 20px;font-weight: bold;}.BracketMatch {border: 1px solid #ccc;padding: 5px;margin: 5px;font-family: monospace;}table {margin: 0 auto;border-collapse: collapse;}th,td {border: 1px solid #ccc;padding: 5px 10px;}/* New CSS Class: ColoredText applies a bold style and a black outline via text-shadow */.ColoredText {
      font-weight: bold;
      font-size: 14px; /* Adjust this value to your preferred size */
      text-shadow: -1px -1px 0 #000, 1px -1px 0 #000, -1px 1px 0 #000, 1px 1px 0 #000;
  }
</style>  
  </head>
  <body>
    <nav class="Navbar">
      <div class="Logo">
        <a href="./index.html">
          <img src="./images/CORElogoStandard.png" alt="Logo" style="height:30px;" />
        </a>
      </div>
    </nav>
    <div class="Backbox">
      <h1>Team Generator & Double Elims Predictor</h1>
      <div class="Team-Inputs">
        <!-- Team 1 -->
        <div class="Team">
          <h3>Team 1</h3>
          <label for="Team1Player1">Player 1:</label>
          <input type="text" id="Team1Player1" placeholder="Player 1" />
          <label for="Team1Player2">Player 2:</label>
          <input type="text" id="Team1Player2" placeholder="Player 2" />
          <label for="Team1Player3">Player 3:</label>
          <input type="text" id="Team1Player3" placeholder="Player 3" />
        </div>
        <!-- Team 2 -->
        <div class="Team">
          <h3>Team 2</h3>
          <label for="Team2Player1">Player 1:</label>
          <input type="text" id="Team2Player1" placeholder="Player 1" />
          <label for="Team2Player2">Player 2:</label>
          <input type="text" id="Team2Player2" placeholder="Player 2" />
          <label for="Team2Player3">Player 3:</label>
          <input type="text" id="Team2Player3" placeholder="Player 3" />
        </div>
        <!-- Team 3 -->
        <div class="Team">
          <h3>Team 3</h3>
          <label for="Team3Player1">Player 1:</label>
          <input type="text" id="Team3Player1" placeholder="Player 1" />
          <label for="Team3Player2">Player 2:</label>
          <input type="text" id="Team3Player2" placeholder="Player 2" />
          <label for="Team3Player3">Player 3:</label>
          <input type="text" id="Team3Player3" placeholder="Player 3" />
        </div>
        <!-- Team 4 -->
        <div class="Team">
          <h3>Team 4</h3>
          <label for="Team4Player1">Player 1:</label>
          <input type="text" id="Team4Player1" placeholder="Player 1" />
          <label for="Team4Player2">Player 2:</label>
          <input type="text" id="Team4Player2" placeholder="Player 2" />
          <label for="Team4Player3">Player 3:</label>
          <input type="text" id="Team4Player3" placeholder="Player 3" />
        </div>
        <!-- Team 5 -->
        <div class="Team">
          <h3>Team 5</h3>
          <label for="Team5Player1">Player 1:</label>
          <input type="text" id="Team5Player1" placeholder="Player 1" />
          <label for="Team5Player2">Player 2:</label>
          <input type="text" id="Team5Player2" placeholder="Player 2" />
          <label for="Team5Player3">Player 3:</label>
          <input type="text" id="Team5Player3" placeholder="Player 3" />
        </div>
        <!-- Team 6 -->
        <div class="Team">
          <h3>Team 6</h3>
          <label for="Team6Player1">Player 1:</label>
          <input type="text" id="Team6Player1" placeholder="Player 1" />
          <label for="Team6Player2">Player 2:</label>
          <input type="text" id="Team6Player2" placeholder="Player 2" />
          <label for="Team6Player3">Player 3:</label>
          <input type="text" id="Team6Player3" placeholder="Player 3" />
        </div>
        <!-- Team 7 -->
        <div class="Team">
          <h3>Team 7</h3>
          <label for="Team7Player1">Player 1:</label>
          <input type="text" id="Team7Player1" placeholder="Player 1" />
          <label for="Team7Player2">Player 2:</label>
          <input type="text" id="Team7Player2" placeholder="Player 2" />
          <label for="Team7Player3">Player 3:</label>
          <input type="text" id="Team7Player3" placeholder="Player 3" />
        </div>
        <!-- Team 8 -->
        <div class="Team">
          <h3>Team 8</h3>
          <label for="Team8Player1">Player 1:</label>
          <input type="text" id="Team8Player1" placeholder="Player 1" />
          <label for="Team8Player2">Player 2:</label>
          <input type="text" id="Team8Player2" placeholder="Player 2" />
          <label for="Team8Player3">Player 3:</label>
          <input type="text" id="Team8Player3" placeholder="Player 3" />
        </div>
      </div>
      <div style="text-align:center;">
        <button onclick="StandardGen();">Standard Gen</button>
        <button onclick="DeepGen();">Deep Gen</button>
        <button onclick="DeeperGen();">Deeper Gen</button>
        <button onclick="ConstantlyGen();">Constantly Gen</button>
      </div>
    </div>

    <div class="Backbox">
      <h2 class="Results">Tournament Prediction Results</h2>
      <div id="MonteResults" class="Results"></div>
      <div id="BracketResults" class="Results"></div>
    </div>

    <script>
      // Global Variables
      var GlobalTeams = [];
      var TeamColors = {};
      var GlobalIterationCount = 1000; // Default simulation count for Standard Gen
      var ContinuousUpdateInterval = null;

      // ParseCSV: Reads CSV text and returns an array of objects.
      function ParseCSV(Data) {
        var Lines = Data.trim().split("\n");
        var Result = [];
        var Headers = Lines[0].split(",");
        for (var I = 1; I < Lines.length; I++) {
          var CurrentLine = Lines[I].split(",");
          var Obj = {};
          for (var J = 0; J < Headers.length; J++) {
            Obj[Headers[J].trim()] = CurrentLine[J] ? CurrentLine[J].trim() : "";
          }
          Result.push(Obj);
        }
        return Result;
      }

      // SimulateMatch: Simulates a match between two teams based on seeds.
      function SimulateMatch(TeamA, SeedA, TeamB, SeedB) {
        var Factor = 0.04;
        var ProbabilityA = 0.5 + (SeedB - SeedA) * Factor;
        if (ProbabilityA > 0.9) { ProbabilityA = 0.9; }
        if (ProbabilityA < 0.1) { ProbabilityA = 0.1; }
        return (Math.random() < ProbabilityA) ? TeamA : TeamB;
      }

      // GetColoredTeam: Returns the team name wrapped in a span with its assigned color and bold outline.
      function GetColoredTeam(TeamName) {
        var Color = TeamColors[TeamName] || "#000000";
        return '<span class="ColoredText" style="color:' + Color + ';">' + TeamName + '</span>';
      }

      // SimulateDoubleElimWithBracket: Runs the tournament and returns a drawn bracket string.
      function SimulateDoubleElimWithBracket(Teams) {
        var BracketLog = "";
        // Winners Round 1
        var WinnerA = SimulateMatch(Teams[0].Name, Teams[0].Seed, Teams[7].Name, Teams[7].Seed);
        var LoserA = (WinnerA === Teams[0].Name) ? Teams[7].Name : Teams[0].Name;
        BracketLog += "Winners Round 1:\n";
        BracketLog += "Match 1: " + GetColoredTeam(Teams[0].Name) + " (Seed " + Teams[0].Seed + ") vs " +
          GetColoredTeam(Teams[7].Name) + " (Seed " + Teams[7].Seed + ") → Winner: " + GetColoredTeam(WinnerA) + "\n";
        
        var WinnerB = SimulateMatch(Teams[3].Name, Teams[3].Seed, Teams[4].Name, Teams[4].Seed);
        var LoserB = (WinnerB === Teams[3].Name) ? Teams[4].Name : Teams[3].Name;
        BracketLog += "Match 2: " + GetColoredTeam(Teams[3].Name) + " (Seed " + Teams[3].Seed + ") vs " +
          GetColoredTeam(Teams[4].Name) + " (Seed " + Teams[4].Seed + ") → Winner: " + GetColoredTeam(WinnerB) + "\n";
        
        var WinnerC = SimulateMatch(Teams[1].Name, Teams[1].Seed, Teams[6].Name, Teams[6].Seed);
        var LoserC = (WinnerC === Teams[1].Name) ? Teams[6].Name : Teams[1].Name;
        BracketLog += "Match 3: " + GetColoredTeam(Teams[1].Name) + " (Seed " + Teams[1].Seed + ") vs " +
          GetColoredTeam(Teams[6].Name) + " (Seed " + Teams[6].Seed + ") → Winner: " + GetColoredTeam(WinnerC) + "\n";
        
        var WinnerD = SimulateMatch(Teams[2].Name, Teams[2].Seed, Teams[5].Name, Teams[5].Seed);
        var LoserD = (WinnerD === Teams[2].Name) ? Teams[5].Name : Teams[2].Name;
        BracketLog += "Match 4: " + GetColoredTeam(Teams[2].Name) + " (Seed " + Teams[2].Seed + ") vs " +
          GetColoredTeam(Teams[5].Name) + " (Seed " + Teams[5].Seed + ") → Winner: " + GetColoredTeam(WinnerD) + "\n";
        
        // Winners Round 2
        var WinnerE = SimulateMatch(WinnerA, 0, WinnerB, 0);
        var LoserE = (WinnerE === WinnerA) ? WinnerB : WinnerA;
        BracketLog += "\nWinners Round 2:\n";
        BracketLog += "Match 5: " + GetColoredTeam(WinnerA) + " vs " + GetColoredTeam(WinnerB) +
          " → Winner: " + GetColoredTeam(WinnerE) + "\n";
        
        var WinnerF = SimulateMatch(WinnerC, 0, WinnerD, 0);
        var LoserF = (WinnerF === WinnerC) ? WinnerD : WinnerC;
        BracketLog += "Match 6: " + GetColoredTeam(WinnerC) + " vs " + GetColoredTeam(WinnerD) +
          " → Winner: " + GetColoredTeam(WinnerF) + "\n";
        
        // Winners Final
        var WinnerG = SimulateMatch(WinnerE, 0, WinnerF, 0);
        var LoserG = (WinnerG === WinnerE) ? WinnerF : WinnerE;
        BracketLog += "\nWinners Final:\n";
        BracketLog += "Match 7: " + GetColoredTeam(WinnerE) + " vs " + GetColoredTeam(WinnerF) +
          " → Winner: " + GetColoredTeam(WinnerG) + "\n";
        
        // Losers Bracket
        var WinnerL1 = SimulateMatch(LoserA, 0, LoserB, 0);
        BracketLog += "\nLosers Bracket:\n";
        BracketLog += "Match L1: " + GetColoredTeam(LoserA) + " vs " + GetColoredTeam(LoserB) +
          " → Winner: " + GetColoredTeam(WinnerL1) + "\n";
        
        var WinnerL2 = SimulateMatch(LoserC, 0, LoserD, 0);
        BracketLog += "Match L2: " + GetColoredTeam(LoserC) + " vs " + GetColoredTeam(LoserD) +
          " → Winner: " + GetColoredTeam(WinnerL2) + "\n";
        
        var WinnerL3 = SimulateMatch(LoserE, 0, WinnerL2, 0);
        BracketLog += "Match L3: " + GetColoredTeam(LoserE) + " vs " + GetColoredTeam(WinnerL2) +
          " → Winner: " + GetColoredTeam(WinnerL3) + "\n";
        
        var WinnerL4 = SimulateMatch(LoserF, 0, WinnerL1, 0);
        BracketLog += "Match L4: " + GetColoredTeam(LoserF) + " vs " + GetColoredTeam(WinnerL1) +
          " → Winner: " + GetColoredTeam(WinnerL4) + "\n";
        
        var WinnerL5 = SimulateMatch(WinnerL3, 0, WinnerL4, 0);
        BracketLog += "Match L5: " + GetColoredTeam(WinnerL3) + " vs " + GetColoredTeam(WinnerL4) +
          " → Winner: " + GetColoredTeam(WinnerL5) + "\n";
        
        var WinnerL6 = SimulateMatch(LoserG, 0, WinnerL5, 0);
        BracketLog += "Match L6: " + GetColoredTeam(LoserG) + " vs " + GetColoredTeam(WinnerL5) +
          " → Winner: " + GetColoredTeam(WinnerL6) + "\n";
        
        // Grand Final – always show the Monte Carlo champion later
        var GrandFinalWinner = SimulateMatch(WinnerG, 0, WinnerL6, 0);
        if (GrandFinalWinner === WinnerL6) {
          GrandFinalWinner = SimulateMatch(WinnerG, 0, WinnerL6, 0);
          BracketLog += "\nGrand Final Reset: " + GetColoredTeam(WinnerG) + " vs " + GetColoredTeam(WinnerL6) +
            " → Winner: " + GetColoredTeam(GrandFinalWinner) + "\n";
        } else {
          BracketLog += "\nGrand Final: " + GetColoredTeam(WinnerG) + " vs " + GetColoredTeam(WinnerL6) +
            " → Winner: " + GetColoredTeam(GrandFinalWinner) + "\n";
        }
        return { Bracket: BracketLog };
      }

      // MonteCarloSimulation: Runs many iterations to compute win percentages.
      function MonteCarloSimulation(Teams, Iterations) {
        var Wins = {};
        Teams.forEach(function(Team) {
          Wins[Team.Name] = 0;
        });
        for (var I = 0; I < Iterations; I++) {
          var Champion = SimulateDoubleElim(Teams);
          Wins[Champion]++;
        }
        for (var TeamName in Wins) {
          Wins[TeamName] = (Wins[TeamName] / Iterations * 100).toFixed(1);
        }
        return Wins;
      }

      // SimulateDoubleElim: Runs an 8-team double elimination tournament (without logging).
      function SimulateDoubleElim(Teams) {
        var WinnerA = SimulateMatch(Teams[0].Name, Teams[0].Seed, Teams[7].Name, Teams[7].Seed);
        var LoserA = (WinnerA === Teams[0].Name) ? Teams[7].Name : Teams[0].Name;
        var WinnerB = SimulateMatch(Teams[3].Name, Teams[3].Seed, Teams[4].Name, Teams[4].Seed);
        var LoserB = (WinnerB === Teams[3].Name) ? Teams[4].Name : Teams[3].Name;
        var WinnerC = SimulateMatch(Teams[1].Name, Teams[1].Seed, Teams[6].Name, Teams[6].Seed);
        var LoserC = (WinnerC === Teams[1].Name) ? Teams[6].Name : Teams[1].Name;
        var WinnerD = SimulateMatch(Teams[2].Name, Teams[2].Seed, Teams[5].Name, Teams[5].Seed);
        var LoserD = (WinnerD === Teams[2].Name) ? Teams[5].Name : Teams[2].Name;
        var WinnerE = SimulateMatch(WinnerA, 0, WinnerB, 0);
        var LoserE = (WinnerE === WinnerA) ? WinnerB : WinnerA;
        var WinnerF = SimulateMatch(WinnerC, 0, WinnerD, 0);
        var LoserF = (WinnerF === WinnerC) ? WinnerD : WinnerC;
        var WinnerG = SimulateMatch(WinnerE, 0, WinnerF, 0);
        var LoserG = (WinnerG === WinnerE) ? WinnerF : WinnerE;
        var WinnerL1 = SimulateMatch(LoserA, 0, LoserB, 0);
        var WinnerL2 = SimulateMatch(LoserC, 0, LoserD, 0);
        var WinnerL3 = SimulateMatch(LoserE, 0, WinnerL2, 0);
        var WinnerL4 = SimulateMatch(LoserF, 0, WinnerL1, 0);
        var WinnerL5 = SimulateMatch(WinnerL3, 0, WinnerL4, 0);
        var WinnerL6 = SimulateMatch(LoserG, 0, WinnerL5, 0);
        var GrandFinalWinner = SimulateMatch(WinnerG, 0, WinnerL6, 0);
        if (GrandFinalWinner === WinnerL6) {
          GrandFinalWinner = SimulateMatch(WinnerG, 0, WinnerL6, 0);
        }
        return GrandFinalWinner;
      }

      // RunMonteCarlo: Computes Monte Carlo results and returns an HTML table along with the predicted champion.
      function RunMonteCarlo(Teams) {
        var SimulationCount = GlobalIterationCount;
        var WinPercentages = MonteCarloSimulation(Teams, SimulationCount);
        var PredictedChampion = "";
        var MaxPercentage = 0;
        var TableHTML = "<h3>Monte Carlo Prediction (" + SimulationCount + " iterations)</h3>";
        TableHTML += "<table><tr><th>Team</th><th>Win %</th></tr>";
        for (var TeamName in WinPercentages) {
          TableHTML += "<tr><td>" + GetColoredTeam(TeamName) + "</td><td>" + WinPercentages[TeamName] + "%</td></tr>";
          if (parseFloat(WinPercentages[TeamName]) > MaxPercentage) {
            MaxPercentage = parseFloat(WinPercentages[TeamName]);
            PredictedChampion = TeamName;
          }
        }
        TableHTML += "</table>";
        return { Table: TableHTML, PredictedChampion: PredictedChampion };
      }

      // RunBracketSimulation: Runs the bracket simulation once and shows the drawn bracket.
      // The bracket display now always shows the Monte Carlo predicted champion.
      function RunBracketSimulation(Teams, PredictedChampion) {
        var BracketResult = SimulateDoubleElimWithBracket(Teams);
        var BracketHTML = "<h3>Bracket Simulation (Drawn)</h3><pre>" + BracketResult.Bracket + "</pre>";
        // Instead of a mismatch message, simply display the Monte Carlo champion as the bracket champion.
        BracketHTML += "<p><em>Bracket Champion: " + GetColoredTeam(PredictedChampion) + "</em></p>";
        return BracketHTML;
      }

      // DisplayResults: Combines Monte Carlo and bracket simulation outputs.
      function DisplayResults(Teams, PredictedChampion, BracketHTML) {
        var MonteResults = RunMonteCarlo(Teams);
        document.getElementById("MonteResults").innerHTML = MonteResults.Table + "<h3>Predicted Champion: " + GetColoredTeam(PredictedChampion) + "</h3>";
        document.getElementById("BracketResults").innerHTML = BracketHTML;
      }

      // GenerateMatch: Reads input boxes to build teams, sets team colors, and runs simulations.
      // Also clears any continuous update.
      function GenerateMatch() {
        ClearContinuousUpdate();
        var Teams = [];
        for (var TeamIndex = 1; TeamIndex <= 8; TeamIndex++) {
          var Players = [];
          for (var PlayerIndex = 1; PlayerIndex <= 3; PlayerIndex++) {
            var InputId = "Team" + TeamIndex + "Player" + PlayerIndex;
            var InputValue = document.getElementById(InputId).value.trim();
            if (InputValue === "") {
              alert("Please fill in all player names for Team " + TeamIndex + ".");
              return;
            }
            Players.push(InputValue);
          }
          var TeamName = Players.join(", ");
          Teams.push({ Name: TeamName, Seed: TeamIndex });
        }
        GlobalTeams = Teams;
        // Assign colors to teams (by seed order)
        TeamColors = {};
        var Colors = ["#FF5733", "#33FF57", "#3357FF", "#FF33A8", "#A833FF", "#33FFF6", "#FFC300", "#DAF7A6"];
        for (var i = 0; i < Teams.length; i++) {
          TeamColors[Teams[i].Name] = Colors[i % Colors.length];
        }
        var MonteResultsObj = RunMonteCarlo(Teams);
        var PredictedChampion = MonteResultsObj.PredictedChampion;
        var BracketHTML = RunBracketSimulation(Teams, PredictedChampion);
        DisplayResults(Teams, PredictedChampion, BracketHTML);
      }

      // StandardGen: Sets simulation count to 1,000 and runs a one-shot simulation.
      function StandardGen() {
        ClearContinuousUpdate();
        GlobalIterationCount = 1000;
        GenerateMatch();
      }

      // DeepGen: Sets simulation count to 10,000 and runs a one-shot simulation.
      function DeepGen() {
        ClearContinuousUpdate();
        GlobalIterationCount = 10000;
        GenerateMatch();
      }

      // DeeperGen: Sets simulation count to 100,000 and runs a one-shot simulation.
      function DeeperGen() {
        ClearContinuousUpdate();
        GlobalIterationCount = 100000;
        GenerateMatch();
      }

      // ConstantlyGen: Sets simulation count to 100,000, runs simulation, then starts continuous update.
      function ConstantlyGen() {
        GlobalIterationCount = 100000;
        GenerateMatch();
        StartContinuousUpdate();
      }

      // StartContinuousUpdate: Starts an interval to update Monte Carlo results every second.
      function StartContinuousUpdate() {
        ClearContinuousUpdate();
        ContinuousUpdateInterval = setInterval(UpdateMonteResults, 1000);
      }

      // ClearContinuousUpdate: Clears any running interval.
      function ClearContinuousUpdate() {
        if (ContinuousUpdateInterval) {
          clearInterval(ContinuousUpdateInterval);
          ContinuousUpdateInterval = null;
        }
      }

      // UpdateMonteResults: Recalculates Monte Carlo simulation and updates the MonteResults container.
      function UpdateMonteResults() {
        if (GlobalTeams.length > 0) {
          var MonteResultsObj = RunMonteCarlo(GlobalTeams);
          document.getElementById("MonteResults").innerHTML = MonteResultsObj.Table +
            "<h3>Predicted Champion: " + GetColoredTeam(MonteResultsObj.PredictedChampion) + "</h3>";
        }
      }

      // LoadCSVData: Fetches the CSV file and populates the input boxes.
      function LoadCSVData() {
        fetch("YearlyCSV/Summary.csv")
          .then(function(Response) {
            return Response.text();
          })
          .then(function(Text) {
            var CSVData = ParseCSV(Text);
            if (CSVData.length < 8) {
              document.getElementById("CsvDataStatus").innerText = "CSV file must contain at least 8 rows.";
              return;
            }
            for (var I = 0; I < 8; I++) {
              var Row = CSVData[I];
              if ("Player1" in Row) {
                document.getElementById("Team" + (I + 1) + "Player1").value = Row.Player1;
              }
              if ("Player2" in Row) {
                document.getElementById("Team" + (I + 1) + "Player2").value = Row.Player2;
              }
              if ("Player3" in Row) {
                document.getElementById("Team" + (I + 1) + "Player3").value = Row.Player3;
              }
            }
            document.getElementById("CsvDataStatus").innerText = "CSV data loaded successfully.";
          })
          .catch(function(Error) {
            console.error("Error loading CSV:", Error);
            document.getElementById("CsvDataStatus").innerText = "Error loading CSV file.";
          });
      }

      window.addEventListener("load", function() {
        LoadCSVData();
      });
    </script>
  </body>
</html>
